from django.shortcuts import render
from maleware.malware_detection_code import MalWareDetection
import hashlib


def malware_detection(request):
    if request.method == "POST":
        uploaded_file = request.FILES["file_name"]
        data_bytes = uploaded_file.read()

        if MalWareDetection.prev != None:
            if MalWareDetection.prev == data_bytes:
                prediction = MalWareDetection.prev_prediction
        else:
            # Validate filename (implement your logic here)
            hash_object = hashlib.sha256(data_bytes)
            hashed_data_hex = hash_object.hexdigest()
            
            data = hashed_data_hex
            prediction = MalWareDetection.solve(data)  # Assuming new_data is scaled
            MalWareDetection.prev = data_bytes
            MalWareDetection.prev_prediction = prediction
        if prediction != True or prediction != False:
            prediction = True

        # Print the predicted class label
        if not prediction:
            result = "Clear"
        else:
            result = "Malicous"
        return render(request,"answer.html",{"answer":result})

    return render(request,"index.html")
